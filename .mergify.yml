# =================================================================================================================================
# Copyright (c) RapidField LLC. Licensed under the MIT License. See LICENSE.txt in the project root for license information.
# =================================================================================================================================
pull_request_rules:
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Label new Dependabot pull requests.
  conditions:
  - author~=(^dependabot.*$)
  - -closed
  - label!=Stage0-New
  - label!=Stage1-UnderReview
  - label!=Stage2-Accepted
  - label!=Stage2-Deferred
  - label!=Stage2-Rejected
  - label!=Stage3-InProgress
  - label!=Stage4-Complete
  - -merged
  actions:
    label:
      add:
      - Category-Maintenance
      - Stage0-New
      - Subcategory-Dependencies
      - Tag-AddReleaseNote
      - Verdict-Pending
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Label new Mergify pull requests.
  conditions:
  - author~=(^mergify.*$)
  - -closed
  - label!=Stage0-New
  - label!=Stage1-UnderReview
  - label!=Stage2-Accepted
  - label!=Stage2-Deferred
  - label!=Stage2-Rejected
  - label!=Stage3-InProgress
  - label!=Stage4-Complete
  - -merged
  actions:
    label:
      add:
      - Category-Maintenance
      - Stage0-New
      - Verdict-Pending
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Label completed pull requests.
  conditions:
  - closed
  - label!=Stage4-Complete
  - merged
  - status-success=continuous-integration/appveyor/pr
  actions:
    label:
      add:
      - Stage4-Complete
      remove:
      - Stage0-New
      - Stage1-UnderReview
      - Stage2-Accepted
      - Stage2-Deferred
      - Stage2-Rejected
      - Stage3-InProgress
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Label backported Mergify pull requests.
  conditions:
  - author~=(^mergify.*$)
  - closed
  - label=Stage4-Complete
  - merged
  - status-success=continuous-integration/appveyor/pr
  - title~=(^.*\(bp .*\)$)
  actions:
    label:
      add:
      - Verdict-Relayed
      remove:
      - Verdict-Pending
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Merge to master when the author is trusted.
  conditions:
  - author~=(^adamjstone$)|(^dependabot.*$)|(^mergify.*$)
  - base=master
  - -closed
  - label!=Stage2-Rejected
  - -merged
  - status-success=continuous-integration/appveyor/pr
  actions:
    merge:
      method: merge
      strict: smart
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Merge to develop when the author is trusted.
  conditions:
  - author~=(^adamjstone$)|(^dependabot.*$)|(^mergify.*$)
  - base=develop
  - -closed
  - label!=Stage2-Rejected
  - -merged
  - status-success=continuous-integration/appveyor/pr
  actions:
    merge:
      method: merge
      strict: smart
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Merge to feature and hotfix branches when the author is trusted.
  conditions:
  - author~=(^adamjstone$)|(^dependabot.*$)|(^mergify.*$)
  - base~=^feature\/(.+)|hotfix\/(.+)
  - -closed
  - label!=Stage2-Rejected
  - -merged
  - status-success=continuous-integration/appveyor/pr
  actions:
    merge:
      method: merge
      strict: smart
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Merge to feature and hotfix branches when reviewed and approved.
  conditions:
  - "#approved-reviews-by>=1"
  - base~=^feature\/(.+)|hotfix\/(.+)
  - -closed
  - label!=Stage2-Rejected
  - -merged
  - status-success=continuous-integration/appveyor/pr
  actions:
    merge:
      method: merge
      strict: smart
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Backport from master when the author is trusted.
  conditions:
  - author~=(^adamjstone$)|(^dependabot.*$)|(^mergify.*$)
  - base=master
  - merged
  - status-success=continuous-integration/appveyor/pr
  actions:
    backport:
      branches: # List active hotfix and release branches here, along with develop.
      # -------------------------------------------------------------------------------------------
      - develop
      - release/v1.0.25-preview1
      - release/v1.0.26-preview1
# ---------------------------------------------------------------------------------------------------------------------------------
- name: Backport from develop when the author is trusted.
  conditions:
  - author~=(^adamjstone$)|(^dependabot.*$)|(^mergify.*$)
  - base=develop
  - merged
  - status-success=continuous-integration/appveyor/pr
  actions:
    backport:
      branches: # List active feature branches here.
      # -------------------------------------------------------------------------------------------
      - feature/0007_rabbitmq-support
      - feature/0012_structuremap-support
# ---------------------------------------------------------------------------------------------------------------------------------